# 超短線突破EA - 數據行情專用

## ⚠️ 重要提醒

**本EA專門針對數據行情超短線交易設計，不適合一天之內持續運行！**

適用場景：
- 非農數據發布時段（20:30-22:00）
- 央行利率決議公布
- CPI、PPI等重要經濟數據發布
- 其他重大市場消息時段

## 項目概述

**超短線突破EA** 是一款專為MetaTrader 4平台設計的自動化交易程序，專注於數據行情期間的超短線突破策略。EA通過在當前價格上下設置Buy Stop和Sell Stop掛單，快速捕捉突破後的價格波動，並配備完善的風險控制機制。

## 核心功能特性

### 1. 自動突破交易
- **動態掛單**: 根據當前市價動態設置買賣掛單位置
- **智能跟隨**: 價格變動時自動調整掛單位置
- **快速執行**: 專為數據行情的快速波動優化

### 2. 多層級移動止損
- **分階段管理**: 根據盈利情況分階段收緊止損
- **自動保護**: 保護浮動盈利，最大化收益

### 3. 熔斷保護機制
- **虧損暫停**: 虧損後自動暫停交易指定時間
- **風險控制**: 避免連續虧損，保護資金安全
- **智能恢復**: 暫停時間結束後自動恢復交易

### 4. 可視化界面
- **實時價格及點差顯示**: 監控當前市場狀況及交易成本
- **手動控制按鈕**: 可隨時手動暫停/繼續EA運行
- **狀態指示**: 清晰顯示EA當前運行狀態

## 參數設置詳解

### 基礎設置 (Setting)

| 參數名 | 類型 | 預設值 | 說明 |
|--------|------|--------|------|
| `註釋` | string | "專做數據行情超短線" | EA描述資訊 |
| `magicnumber` | int | 333 | EA唯一標識號，與熔斷機制相關 |
| `AutoLot` | bool | true | 是否啟用自動手數計算 |
| `AutoLotMode` | enum | 20 | 風險等級：Expert(10)激進/Moderate(20)穩健/Safe(30)保守 |
| `FixLot` | double | 0.01 | 固定手數大小（AutoLot=false時使用） |

### 訂單設置 (Order Setting)

| 參數名 | 類型 | 預設值 | 說明 |
|--------|------|--------|------|
| `stoploss` | int | 162 | 止損距離（點數），已優化為黃金分割比 |
| `takeprofit` | int | 1300 | 止盈距離（點數） |
| `step` | int | 162 | 掛單距離當前價格的點數 |

### 時間過濾 (Time Filter)

| 參數名 | 類型 | 預設值 | 說明 |
|--------|------|--------|------|
| `StartHour` | int | 1 | 開始交易時間（小時，0-23） |
| `StopHour` | int | 23 | 停止交易時間（小時，0-23） |

### 熔斷機制設置 (Stop on Loss Setting)

| 參數名 | 類型 | 預設值 | 說明 |
|--------|------|--------|------|
| `PauseOnLoss_Enabled` | bool | true | 是否啟用虧損後暫停功能 |
| `PauseDuration_Minutes` | int | 1 | 暫停時長（分鐘） |
| `DeletePendingsOnLoss` | bool | true | 虧損時是否刪除所有掛單 |

### 界面顯示設置

| 參數名 | 類型 | 預設值 | 說明 |
|--------|------|--------|------|
| `市場信息字体大小` | int | 16 | 價格和點差顯示字体大小 |
| `市場信息颜色` | color | White | 價格和點差顯示颜色 |
| `ShowStopButton` | bool | true | 是否顯示暫停按鈕 |
| `StopButtonFontSize` | int | 14 | 暫停按鈕字体大小 |
| `StopButtonColor` | color | Red | 暫停按鈕字体颜色 |
| `StopButtonBgColor` | color | White | 暫停按鈕背景颜色 |
| `ContinueButtonColor` | color | Green | 繼續按鈕字体颜色 |
| `ContinueButtonBgColor` | color | LightGreen | 繼續按鈕背景颜色 |

## 核心變數說明

### 風險管理變數
- `zong_1_do` (0.3): 風險係數，用於手數計算
- `zong_2_do`: 風險除數，基於AutoLotMode×100計算

### 移動止損參數
- `zong_3_in` (250): 第一階段止損移動步長
- `zong_4_in` (200): 基礎止損距離
- `zong_5_in` (100): 第二階段止損移動距離
- `zong_6_in` (50): 第二階段止損移動步長
- `zong_7_in` (100): 第三階段止損移動距離
- `zong_8_in` (50): 第三階段止損移動步長

### 掛單管理變數
- `zong_23_in` (1): 掛單頻率控制
- `zong_24_in` (30): 價格變動闾值，超過此值才移動掛單

### 狀態控制變數
- `pauseEndTime`: 暫停結束時間戳
- `lastLossTime`: 最後一次虧損時間，防止重複觸發熔斷
- `isCircuitBreakerActive`: 熔斷機制激活狀態
- `isEAStopped`: EA手動暫停狀態

## 核心功能實現

### 1. 智能手數計算
```mql4
double LotsOptimized()
{
    // 自動手數：帳戶餘額 / (風險等級×100) × 風險係數
    // 固定手數：使用FixLot設定值
    // 包含四捨五入和邊界檢查邏輯
}
```

### 2. 多階段移動止損
- **階段1**: 初始止損距離200點
- **階段2**: 盈利後收緊至100點距離，步長50點
- **階段3**: 進一步盈利後收緊至50點距離，步長50點
- **自動跟隨**: 根據盈利情況動態調整止損位置

### 3. 熔斷保護機制
- **觸發條件**: 檢測到新的虧損訂單
- **執行動作**: 暫停交易、可選刪除掛單
- **狀態同步**: 與手動暫停按鈕狀態聯動
- **自動恢復**: 暫停時間結束後自動繼續

### 4. 掛單管理邏輯
- **動態下單**: 在當前價格±step距離設置Buy Stop/Sell Stop
- **智能跟隨**: 價格變動超過30點時自動調整掛單位置
- **時間控制**: 僅在設定時間範圍內執行交易

## 使用注意事項

### ⚠️ 關鍵限制
1. **專用於數據行情**: 僅適合重要數據發布時的短時間使用
2. **不宜長期運行**: 不建議24小時或一整天持續運行
3. **需要監控**: 建議在數據發布前後手動監控

### 💡 最佳實踐
1. **時間設置**: 將StartHour和StopHour設置為數據發布前後1-2小時
2. **風險控制**: 使用Moderate(20)風險等級，避免過度激進
3. **點差監控**: 關注實時價格及點差顯示，高點差時暫停使用
4. **測試驗證**: 在模擬帳戶充分測試後再用於實盤

### 🔧 操作建議
1. **數據前準備**: 提前5-10分鐘啟動EA
2. **實時監控**: 通過界面按鈕隨時控制EA狀態
3. **數據後處理**: 行情結束後及時手動暫停EA
4. **風險管理**: 設置合理的止損和倉位大小

## 檔案說明

- `超短線.mq4`: 主要EA程序檔案
- `111突破.mq4`: 可能的備用版本
- `README.md`: 本說明文檔

## 技術特點

- **平台**: MetaTrader 4 (MQL4)
- **交易品種**: 主要針對XAUUSD（黃金）
- **策略類型**: 突破策略 + 風險控制
- **執行方式**: 全自動化執行
- **界面**: 可視化狀態顯示和手動控制

---

**風險警告**: 外匯交易存在風險，過往表現不代表未來結果。請在充分了解風險的前提下使用本EA，建議先在模擬帳戶測試。