# 超短线突破EA - 数据行情专用

## ⚠️ 重要提醒

**本EA专门针对数据行情超短线交易设计，不适合一天之内持续运行！**

适用场景：
- 非农数据发布时段（20:30-22:00）
- 央行利率决议公布
- CPI、PPI等重要经济数据发布
- 其他重大市场消息时段

## 项目概述

**超短线突破EA** 是一款专为MetaTrader 4平台设计的自动化交易程序，专注于数据行情期间的超短线突破策略。EA通过在当前价格上下设置Buy Stop和Sell Stop挂单，快速捕捉突破后的价格波动，并配备完善的风险控制机制。

## 核心功能特性

### 1. 自动突破交易
- **动态挂单**: 根据当前市价动态设置买卖挂单位置
- **智能跟随**: 价格变动时自动调整挂单位置
- **快速执行**: 专为数据行情的快速波动优化

### 2. 多层级移动止损
- **分阶段管理**: 根据盈利情况分阶段收紧止损
- **自动保护**: 保护浮动盈利，最大化收益

### 3. 熔断保护机制
- **亏损暂停**: 亏损后自动暂停交易指定时间
- **风险控制**: 避免连续亏损，保护资金安全
- **智能恢复**: 暂停时间结束后自动恢复交易

### 4. 可视化界面
- **实时点差显示**: 监控当前交易成本
- **手动控制按钮**: 可随时手动停止/继续EA运行
- **状态指示**: 清晰显示EA当前运行状态

## 参数设置详解

### 基础设置 (Setting)

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `注释` | string | "专做数据行情超短线" | EA描述信息 |
| `magicnumber` | int | 333 | EA唯一标识号，与熔断机制相关 |
| `AutoLot` | bool | true | 是否启用自动手数计算 |
| `AutoLotMode` | enum | 20 | 风险等级：Expert(10)激进/Moderate(20)稳健/Safe(30)保守 |
| `FixLot` | double | 0.01 | 固定手数大小（AutoLot=false时使用） |

### 订单设置 (Order Setting)

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `stoploss` | int | 162 | 止损距离（点数），已优化为黄金分割比 |
| `takeprofit` | int | 1300 | 止盈距离（点数） |
| `step` | int | 162 | 挂单距离当前价格的点数 |

### 时间过滤 (Time Filter)

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `StartHour` | int | 1 | 开始交易时间（小时，0-23） |
| `StopHour` | int | 23 | 停止交易时间（小时，0-23） |

### 熔断机制设置 (Stop on Loss Setting)

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `PauseOnLoss_Enabled` | bool | true | 是否启用亏损后暂停功能 |
| `PauseDuration_Minutes` | int | 1 | 暂停时长（分钟） |
| `DeletePendingsOnLoss` | bool | true | 亏损时是否删除所有挂单 |

### 界面显示设置

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `ShowSpread` | bool | true | 是否显示点差 |
| `SpreadFontSize` | int | 16 | 点差显示字体大小 |
| `SpreadColor` | color | Red | 点差显示颜色 |
| `ShowStopButton` | bool | true | 是否显示停止按钮 |
| `StopButtonFontSize` | int | 14 | 停止按钮字体大小 |
| `StopButtonColor` | color | Red | 停止按钮字体颜色 |
| `StopButtonBgColor` | color | White | 停止按钮背景颜色 |
| `ContinueButtonColor` | color | Green | 继续按钮字体颜色 |
| `ContinueButtonBgColor` | color | LightGreen | 继续按钮背景颜色 |

## 核心变量说明

### 风险管理变量
- `zong_1_do` (0.3): 风险系数，用于手数计算
- `zong_2_do`: 风险除数，基于AutoLotMode×100计算

### 移动止损参数
- `zong_3_in` (250): 第一阶段止损移动步长
- `zong_4_in` (200): 基础止损距离
- `zong_5_in` (100): 第二阶段止损移动距离
- `zong_6_in` (50): 第二阶段止损移动步长
- `zong_7_in` (100): 第三阶段止损移动距离
- `zong_8_in` (50): 第三阶段止损移动步长

### 挂单管理变量
- `zong_23_in` (1): 挂单频率控制
- `zong_24_in` (30): 价格变动阈值，超过此值才移动挂单

### 状态控制变量
- `pauseEndTime`: 暂停结束时间戳
- `lastLossTime`: 最后一次亏损时间，防止重复触发熔断
- `isCircuitBreakerActive`: 熔断机制激活状态
- `isEAStopped`: EA手动停止状态

## 核心功能实现

### 1. 智能手数计算
```mql4
double LotsOptimized()
{
    // 自动手数：账户余额 / (风险等级×100) × 风险系数
    // 固定手数：使用FixLot设定值
    // 包含四舍五入和边界检查逻辑
}
```

### 2. 多阶段移动止损
- **阶段1**: 初始止损距离200点
- **阶段2**: 盈利后收紧至100点距离，步长50点
- **阶段3**: 进一步盈利后收紧至50点距离，步长50点
- **自动跟随**: 根据盈利情况动态调整止损位置

### 3. 熔断保护机制
- **触发条件**: 检测到新的亏损订单
- **执行动作**: 暂停交易、可选删除挂单
- **状态同步**: 与手动停止按钮状态联动
- **自动恢复**: 暂停时间结束后自动继续

### 4. 挂单管理逻辑
- **动态下单**: 在当前价格±step距离设置Buy Stop/Sell Stop
- **智能跟随**: 价格变动超过30点时自动调整挂单位置
- **时间控制**: 仅在设定时间范围内执行交易

## 使用注意事项

### ⚠️ 关键限制
1. **专用于数据行情**: 仅适合重要数据发布时的短时间使用
2. **不宜长期运行**: 不建议24小时或一整天持续运行
3. **需要监控**: 建议在数据发布前后手动监控

### 💡 最佳实践
1. **时间设置**: 将StartHour和StopHour设置为数据发布前后1-2小时
2. **风险控制**: 使用Moderate(20)风险等级，避免过度激进
3. **点差监控**: 关注实时点差显示，高点差时暂停使用
4. **测试验证**: 在模拟账户充分测试后再用于实盘

### 🔧 操作建议
1. **数据前准备**: 提前5-10分钟启动EA
2. **实时监控**: 通过界面按钮随时控制EA状态
3. **数据后处理**: 行情结束后及时手动停止EA
4. **风险管理**: 设置合理的止损和仓位大小

## 文件说明

- `超短线.mq4`: 主要EA程序文件
- `111突破.mq4`: 可能的备用版本
- `README.md`: 本说明文档

## 技术特点

- **平台**: MetaTrader 4 (MQL4)
- **交易品种**: 主要针对XAUUSD（黄金）
- **策略类型**: 突破策略 + 风险控制
- **执行方式**: 全自动化执行
- **界面**: 可视化状态显示和手动控制

---

**风险警告**: 外汇交易存在风险，过往表现不代表未来结果。请在充分了解风险的前提下使用本EA，建议先在模拟账户测试。